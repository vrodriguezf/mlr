<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Google Site Verification --><meta name="google-site-verification" content="BrjL5fpoyHZu1rR8rwnnM2MBO3u3iIFB8NsmSuOsY84">
<title>Handling of Spatial Data • mlr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../jquery.sticky-kit.min.js"></script><script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<script src="../../extra.js"></script><meta property="og:title" content="Handling of Spatial Data">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
<link rel="icon" type="image/png" href="https://mlr-org.github.io/mlr/favicon.ico">
<link rel="apple-touch-icon" type="image/png" href="https://mlr-org.github.io/mlr/favicon.ico">
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../../index.html"></a>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/tutorial/task.html">Tasks</a>
    </li>
    <li>
      <a href="../../articles/tutorial/learner.html">Learners</a>
    </li>
    <li>
      <a href="../../articles/tutorial/train.html">Train</a>
    </li>
    <li>
      <a href="../../articles/tutorial/predict.html">Predict</a>
    </li>
    <li>
      <a href="../../articles/tutorial/preproc.html">Preprocessing</a>
    </li>
    <li>
      <a href="../../articles/tutorial/performance.html">Performance</a>
    </li>
    <li>
      <a href="../../articles/tutorial/resample.html">Resampling</a>
    </li>
    <li>
      <a href="../../articles/tutorial/tune.html">Tuning</a>
    </li>
    <li>
      <a href="../../articles/tutorial/benchmark_experiments.html">Benchmark Experiments</a>
    </li>
    <li>
      <a href="../../articles/tutorial/parallelization.html">Parallelization</a>
    </li>
    <li>
      <a href="../../articles/tutorial/visualization.html">Visualization</a>
    </li>
    <li>
      <a href="../../articles/tutorial/usecase_regression.html">Use case - Regression</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Advanced
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/tutorial/configureMlr.html">Configuration</a>
    </li>
    <li>
      <a href="../../articles/tutorial/wrapper.html">Wrapped Learners</a>
    </li>
    <li>
      <a href="../../articles/tutorial/impute.html">Imputation</a>
    </li>
    <li>
      <a href="../../articles/tutorial/bagging.html">Generic Bagging</a>
    </li>
    <li>
      <a href="../../articles/tutorial/advanced_tune.html">Advanced Tuning</a>
    </li>
    <li>
      <a href="../../articles/tutorial/feature_selection.html">Feature Selection/Filtering</a>
    </li>
    <li>
      <a href="../../articles/tutorial/nested_resampling.html">Nested Resampling</a>
    </li>
    <li>
      <a href="../../articles/tutorial/cost_sensitive_classif.html">Cost-Sensitive Classification</a>
    </li>
    <li>
      <a href="../../articles/tutorial/over_and_undersampling.html">Imbalanced Classification Problems</a>
    </li>
    <li>
      <a href="../../articles/tutorial/roc_analysis.html">ROC Analysis and Performance Curves</a>
    </li>
    <li>
      <a href="../../articles/tutorial/multilabel.html">Multilabel Classification</a>
    </li>
    <li>
      <a href="../../articles/tutorial/learning_curve.html">Learning Curve Analysis</a>
    </li>
    <li>
      <a href="../../articles/tutorial/partial_dependence.html">Partial Dependence Plots</a>
    </li>
    <li>
      <a href="../../articles/tutorial/classifier_calibration.html">Classifier Calibration</a>
    </li>
    <li>
      <a href="../../articles/tutorial/hyperpar_tuning_effects.html">Hyperparameter Tuning Effects</a>
    </li>
    <li>
      <a href="../../articles/tutorial/out_of_bag_predictions.html">Out-of-Bag Predictions</a>
    </li>
    <li>
      <a href="../../articles/tutorial/handling_of_spatial_data.html">Handling of Spatial Data</a>
    </li>
    <li>
      <a href="../../articles/tutorial/functional_data.html">Functional Data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Extending
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/tutorial/create_learner.html">Create Custom Learners</a>
    </li>
    <li>
      <a href="../../articles/tutorial/create_measure.html">Create Custom Measures</a>
    </li>
    <li>
      <a href="../../articles/tutorial/create_imputation.html">Create Imputation Methods</a>
    </li>
    <li>
      <a href="../../articles/tutorial/create_filter.html">Create Custom Filters</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Appendix
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../reference/index.html">Function Reference</a>
    </li>
    <li>
      <a href="../../news/index.html">News</a>
    </li>
    <li>
      <a href="../../articles/tutorial/example_tasks.html">Example Tasks</a>
    </li>
    <li>
      <a href="../../articles/tutorial/integrated_learners.html">Integrated Learners</a>
    </li>
    <li>
      <a href="../../articles/tutorial/measures.html">Implemented Measures</a>
    </li>
    <li>
      <a href="../../articles/tutorial/filter_methods.html">Integrated Filter Methods</a>
    </li>
    <li>
      <a href="../../articles/tutorial/mlr_publications.html">mlr Publications</a>
    </li>
    <li>
      <a href="../../articles/tutorial/talks_videos_workshops.html">Talks, Videos and Workshops</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    mlr-org Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://github.com/mlr-org/mlrMBO">mlrMBO</a>
    </li>
    <li>
      <a href="https://github.com/mlr-org/mlrCPO">mlrCPO</a>
    </li>
    <li>
      <a href="https://jakob-r.de/mlrHyperopt/index.html">mlrHyperopt</a>
    </li>
    <li>
      <a href="https://openml.github.io/openml-r/vignettes/OpenML.html">OpenML</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlr-org/mlr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.slack.com">
    <span class="fa fa-slack"></span>
     
  </a>
</li>
<li>
  <a href="https://stackoverflow.com/questions/tagged/mlr">
    <span class="fa fa-stack-overflow"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.com/">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Handling of Spatial Data</h1>
                        <h4 class="author">Patrick Schratz</h4>
            
      
      <!--The 'toc' block was inserted manually by @pat-s. It triggeres the inline ToC in the vignettes.-->
            <div id="toc">
      <h3 class="hasAnchor">
<a href="#toc" class="anchor"></a>Table of Contents</h3>
      <ul>
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#how-to-use-spatial-partitioning-in-mlr">How to use spatial partitioning in mlr</a></li>
      <li>
<a href="#examples">Examples</a><ul>
<li><a href="#spatial-cross-validation">Spatial Cross-Validation</a></li>
      <li><a href="#non-spatial-cross-validation">Non-Spatial Cross-Validation</a></li>
      </ul>
</li>
      <li><a href="#visualization-of-spatial-partitions">Visualization of spatial partitions</a></li>
      <li><a href="#notes">Notes</a></li>
      </ul>
</div>
      
      <small>Source: <a href="https://github.com/mlr-org/mlr/blob/master/vignettes/tutorial/handling_of_spatial_data.Rmd"><code>vignettes/tutorial/handling_of_spatial_data.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Spatial data is different from non-spatial data by having a spatial reference information attached to each observation. This information is usually stored as coordinates, often named <code>x</code> and <code>y</code>. Coordinates are either stored in UTM (Universal Transverse Mercator) or latitude/longitude format.</p>
<p>Treating spatial data sets like non-spatial ones leads to overoptimistic results in predictive accuracy of models (<a href="https://www.nat-hazards-earth-syst-sci.net/5/853/2005/">Brenning 2005</a>). This is due to the underlying spatial autocorrelation in the data. Spatial autocorrelation does occur in all spatial data sets. Magnitude varies depending on the characteristics of the data set. The closer observations are located to each other, the more similar they are.</p>
<p>If common validation procedures like cross-validation are applied to such data sets, they assume independence of the observation upfront to provide unbiased estimates. However, this assumption is violated in the spatial case due to spatial autocorrelation. Subsequently, non-spatial cross-validation will fail to provide accurate performance estimates.</p>
<div class="figure" style="text-align: center">
<img src="https://raw.githubusercontent.com/pat-s/mlr/master/vignettes/tutorial/devel/pdf/img/spatial_cross_validation.png" alt="Nested Spatial and Non-Spatial Cross-Validation" width="600px"><p class="caption">
Nested Spatial and Non-Spatial Cross-Validation
</p>
</div>
<p>By doing a random sampling of the data set (i.e., non-spatial sampling), training and test set data are often located directly next to each other (in geographical space). Hence, the test set will contain observations which are somewhat similar (due to spatial autocorrelation) to observations in the training set. This leads to the effect that the model, which was trained on the training set, performs quite well on the test data because it already knows it to some degree.</p>
<p>To reduce this bias on the resulting predictive accuracy estimate, <a href="https://www.nat-hazards-earth-syst-sci.net/5/853/2005/">Brenning 2005</a> suggested using spatial partitioning in favor of random partitioning (see Figure 1). Here, spatial clusters are equal to the number of folds chosen. These spatially disjoint subsets of the data introduce a spatial distance between training and test set. This reduces the influence of spatial autocorrelation and subsequently also the overoptimistic predictive accuracy estimates. The example in Figure 1 shows a five-fold nested cross-validation setting and exhibits the difference between spatial and non-spatial partitioning. The nested approach is used when hyperparameter tuning is performed.</p>
</div>
<div id="how-to-use-spatial-partitioning-in-mlr" class="section level1">
<h1 class="hasAnchor">
<a href="#how-to-use-spatial-partitioning-in-mlr" class="anchor"></a>How to use spatial partitioning in mlr</h1>
<p>Spatial partitioning can be used when performing cross-validation. In any <code><a href="../../reference/resample.html">resample()</a></code> call you can choose <code>SpCV</code> or <code>SpRepCV</code> to use it. While <code>SpCV</code> will perform a spatial cross-validation with only one repetition, <code>SpRepCV</code> gives you the option to choose any number of repetitions. As a rule of thumb, usually 100 repetitions are used with the aim to reduce variance introduced by partitioning.</p>
<p>There are some prerequisites for this:</p>
<p>When specifying the <a href="task.html" target="_blank">task</a>, you need to provide spatial coordinates through argument <code>coordinates</code>. The supplied <code>data.frame</code> needs to have the same number of rows as the data and at least two dimensions need to be supplied. This means that a 3-D partitioning might also work but we have not tested this explicitly. Coordinates need to be numeric so it is suggested to use a UTM projection. If this applies, the coordinates will be used for spatial partitioning if <code>SpCV</code> or <code>SpRepCV</code> is selected as resampling strategy.</p>
</div>
<div id="examples" class="section level1">
<h1 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h1>
<p>The <code>spatial.task</code> data set serves as an example data set for spatial modeling tasks in <code>mlr</code>. The <a href="task.html" target="_blank">task</a> argument <code>coordinates</code> is a <code>data.frame</code> with two coordinates that will later be used for the spatial partitioning of the data set.</p>
<p>In this example, the “Random Forest” algorithm (package <a href="&amp;ranger::ranger">ranger</a>) is used to model a binomial response variable.</p>
<p>For performance assessment, a repeated spatial cross-validation with 5 folds and 5 repetitions is chosen.</p>
<div id="spatial-cross-validation" class="section level2">
<h2 class="hasAnchor">
<a href="#spatial-cross-validation" class="anchor"></a>Spatial Cross-Validation</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"spatial.task"</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a>spatial.task</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">## Supervised task: ecuador</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">## Type: classif</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">## Target: slides</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">## Observations: 751</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">## Features:</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">##    numerics     factors     ordered functionals </span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">##          10           0           0           0 </span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">## Missings: FALSE</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">## Has weights: FALSE</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">## Has blocking: FALSE</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">## Has coordinates: TRUE</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">## Classes: 2</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">## FALSE  TRUE </span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co">##   251   500 </span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="co">## Positive class: TRUE</span></span>
<span id="cb1-18"><a href="#cb1-18"></a></span>
<span id="cb1-19"><a href="#cb1-19"></a>learner.rf =<span class="st"> </span><span class="kw"><a href="../../reference/makeLearner.html">makeLearner</a></span>(<span class="st">"classif.ranger"</span>, <span class="dt">predict.type =</span> <span class="st">"prob"</span>)</span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a>resampling =<span class="st"> </span><span class="kw"><a href="../../reference/makeResampleDesc.html">makeResampleDesc</a></span>(<span class="st">"SpRepCV"</span>, <span class="dt">fold =</span> <span class="dv">5</span>, <span class="dt">reps =</span> <span class="dv">5</span>)</span>
<span id="cb1-22"><a href="#cb1-22"></a></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">123</span>)</span>
<span id="cb1-24"><a href="#cb1-24"></a>out =<span class="st"> </span><span class="kw"><a href="../../reference/resample.html">resample</a></span>(<span class="dt">learner =</span> learner.rf, <span class="dt">task =</span> spatial.task,</span>
<span id="cb1-25"><a href="#cb1-25"></a>  <span class="dt">resampling =</span> resampling, <span class="dt">measures =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(auc))</span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="co">## Resampling: repeated spatial cross-validation</span></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="co">## Measures:             auc</span></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="co">## [Resample] iter 1:    0.5392857</span></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="co">## [Resample] iter 2:    0.7000000</span></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="co">## [Resample] iter 3:    0.6744392</span></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="co">## [Resample] iter 4:    0.7329260</span></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="co">## [Resample] iter 5:    0.4515399</span></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="co">## [Resample] iter 6:    0.6945565</span></span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="co">## [Resample] iter 7:    0.7149533</span></span>
<span id="cb1-35"><a href="#cb1-35"></a><span class="co">## [Resample] iter 8:    0.6719303</span></span>
<span id="cb1-36"><a href="#cb1-36"></a><span class="co">## [Resample] iter 9:    0.4397645</span></span>
<span id="cb1-37"><a href="#cb1-37"></a><span class="co">## [Resample] iter 10:   0.5276786</span></span>
<span id="cb1-38"><a href="#cb1-38"></a><span class="co">## [Resample] iter 11:   0.6710449</span></span>
<span id="cb1-39"><a href="#cb1-39"></a><span class="co">## [Resample] iter 12:   0.7147735</span></span>
<span id="cb1-40"><a href="#cb1-40"></a><span class="co">## [Resample] iter 13:   0.7139113</span></span>
<span id="cb1-41"><a href="#cb1-41"></a><span class="co">## [Resample] iter 14:   0.4413496</span></span>
<span id="cb1-42"><a href="#cb1-42"></a><span class="co">## [Resample] iter 15:   0.5345238</span></span>
<span id="cb1-43"><a href="#cb1-43"></a><span class="co">## [Resample] iter 16:   0.7166549</span></span>
<span id="cb1-44"><a href="#cb1-44"></a><span class="co">## [Resample] iter 17:   0.4527473</span></span>
<span id="cb1-45"><a href="#cb1-45"></a><span class="co">## [Resample] iter 18:   0.7090873</span></span>
<span id="cb1-46"><a href="#cb1-46"></a><span class="co">## [Resample] iter 19:   0.5315006</span></span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="co">## [Resample] iter 20:   0.6731110</span></span>
<span id="cb1-48"><a href="#cb1-48"></a><span class="co">## [Resample] iter 21:   0.7293578</span></span>
<span id="cb1-49"><a href="#cb1-49"></a><span class="co">## [Resample] iter 22:   0.7102675</span></span>
<span id="cb1-50"><a href="#cb1-50"></a><span class="co">## [Resample] iter 23:   0.4459096</span></span>
<span id="cb1-51"><a href="#cb1-51"></a><span class="co">## [Resample] iter 24:   0.5300687</span></span>
<span id="cb1-52"><a href="#cb1-52"></a><span class="co">## [Resample] iter 25:   0.6655844</span></span>
<span id="cb1-53"><a href="#cb1-53"></a><span class="co">## </span></span>
<span id="cb1-54"><a href="#cb1-54"></a><span class="co">## Aggregated Result: auc.test.mean=0.6154786</span></span>
<span id="cb1-55"><a href="#cb1-55"></a><span class="co">## </span></span>
<span id="cb1-56"><a href="#cb1-56"></a></span>
<span id="cb1-57"><a href="#cb1-57"></a><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(out<span class="op">$</span>measures.test<span class="op">$</span>auc)</span>
<span id="cb1-58"><a href="#cb1-58"></a><span class="co">## [1] 0.6154786</span></span></code></pre></div>
<p>We can check for the introduced spatial autocorrelation bias here by performing the same modeling task using a non-spatial partitioning setting. To do so, we simply choose <code>RepCV</code> instead of <code>SpRepCV</code>. There is no need to remove <code>coordinates</code> from the task as it is only used if <code>SpCV</code> or <code>SpRepCV</code> is selected as the resampling strategy.</p>
</div>
<div id="non-spatial-cross-validation" class="section level2">
<h2 class="hasAnchor">
<a href="#non-spatial-cross-validation" class="anchor"></a>Non-Spatial Cross-Validation</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>learner.rf =<span class="st"> </span><span class="kw"><a href="../../reference/makeLearner.html">makeLearner</a></span>(<span class="st">"classif.ranger"</span>, <span class="dt">predict.type =</span> <span class="st">"prob"</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a>resampling =<span class="st"> </span><span class="kw"><a href="../../reference/makeResampleDesc.html">makeResampleDesc</a></span>(<span class="st">"RepCV"</span>, <span class="dt">fold =</span> <span class="dv">5</span>, <span class="dt">reps =</span> <span class="dv">5</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">123</span>)</span>
<span id="cb2-6"><a href="#cb2-6"></a>out =<span class="st"> </span><span class="kw"><a href="../../reference/resample.html">resample</a></span>(<span class="dt">learner =</span> learner.rf, <span class="dt">task =</span> spatial.task,</span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="dt">resampling =</span> resampling, <span class="dt">measures =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(auc))</span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">## Resampling: repeated cross-validation</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">## Measures:             auc</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">## [Resample] iter 1:    0.7549787</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">## [Resample] iter 2:    0.7895448</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">## [Resample] iter 3:    0.7285329</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">## [Resample] iter 4:    0.8018791</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">## [Resample] iter 5:    0.7414354</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">## [Resample] iter 6:    0.7957672</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">## [Resample] iter 7:    0.7939276</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">## [Resample] iter 8:    0.7583612</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co">## [Resample] iter 9:    0.6615442</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co">## [Resample] iter 10:   0.8353511</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co">## [Resample] iter 11:   0.7787307</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="co">## [Resample] iter 12:   0.7515909</span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="co">## [Resample] iter 13:   0.7812500</span></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="co">## [Resample] iter 14:   0.7398026</span></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="co">## [Resample] iter 15:   0.7712507</span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="co">## [Resample] iter 16:   0.7807924</span></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="co">## [Resample] iter 17:   0.7427213</span></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="co">## [Resample] iter 18:   0.7523445</span></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="co">## [Resample] iter 19:   0.7982883</span></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="co">## [Resample] iter 20:   0.6993332</span></span>
<span id="cb2-30"><a href="#cb2-30"></a><span class="co">## [Resample] iter 21:   0.7247929</span></span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="co">## [Resample] iter 22:   0.7368421</span></span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="co">## [Resample] iter 23:   0.7767107</span></span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="co">## [Resample] iter 24:   0.7428627</span></span>
<span id="cb2-34"><a href="#cb2-34"></a><span class="co">## [Resample] iter 25:   0.8179012</span></span>
<span id="cb2-35"><a href="#cb2-35"></a><span class="co">## </span></span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="co">## Aggregated Result: auc.test.mean=0.7622615</span></span>
<span id="cb2-37"><a href="#cb2-37"></a><span class="co">## </span></span>
<span id="cb2-38"><a href="#cb2-38"></a></span>
<span id="cb2-39"><a href="#cb2-39"></a><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(out<span class="op">$</span>measures.test<span class="op">$</span>auc)</span>
<span id="cb2-40"><a href="#cb2-40"></a><span class="co">## [1] 0.7622615</span></span></code></pre></div>
<p>The introduced bias (caused by spatial autocorrelation) in performance in this example is around 0.12 AUROC.</p>
</div>
</div>
<div id="visualization-of-spatial-partitions" class="section level1">
<h1 class="hasAnchor">
<a href="#visualization-of-spatial-partitions" class="anchor"></a>Visualization of spatial partitions</h1>
<p>You can visualize the spatial partitioning using <code><a href="../../reference/createSpatialResamplingPlots.html">createSpatialResamplingPlots()</a></code>. This function creates multiple <code>ggplot2</code> objects that can then be visualized in a gridded way using your favorite “plot arrangement” function We recommend to use <code><a href="https://rdrr.io/pkg/cowplot/man/plot_grid.html">cowplot::plot_grid()</a></code> and <code><a href="https://rdrr.io/pkg/cowplot/man/save_plot.html">cowplot::save_plot()</a></code> for this.</p>
<p>You can pass multiple <code>resample</code> result objects as inputs. This is useful to visualize the differences between a spatial and non-spatial partitioning. If you pass the <code>resample</code> objects in a named list, those names will be populated as plot titles. By default everything is reprojected to EPSG: 4326 (WGS 84) but this can be changed using the argument <code>datum</code>. If you do not like the plot appearance, you can customize all plots stored in the resulting list by just applying a function on the list, for example using <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map()</a></code>, <code><a href="https://rdrr.io/r/base/lapply.html">base::lapply()</a></code> or similar functions.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mlr)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(cowplot)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">## </span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">## ********************************************************</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">## Note: As of version 1.0.0, cowplot does not change the</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">##   default ggplot2 theme anymore. To recover the previous</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">##   behavior, execute:</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">##   theme_set(theme_cowplot())</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">## ********************************************************</span></span>
<span id="cb3-10"><a href="#cb3-10"></a> </span>
<span id="cb3-11"><a href="#cb3-11"></a>rdesc1 =<span class="st"> </span><span class="kw"><a href="../../reference/makeResampleDesc.html">makeResampleDesc</a></span>(<span class="st">"SpRepCV"</span>, <span class="dt">folds =</span> <span class="dv">5</span>, <span class="dt">reps =</span> <span class="dv">4</span>)</span>
<span id="cb3-12"><a href="#cb3-12"></a>r1 =<span class="st"> </span><span class="kw"><a href="../../reference/resample.html">resample</a></span>(<span class="kw"><a href="../../reference/makeLearner.html">makeLearner</a></span>(<span class="st">"classif.qda"</span>), spatial.task, rdesc1, <span class="dt">show.info =</span> <span class="ot">FALSE</span>)</span>
<span id="cb3-13"><a href="#cb3-13"></a>rdesc2 =<span class="st"> </span><span class="kw"><a href="../../reference/makeResampleDesc.html">makeResampleDesc</a></span>(<span class="st">"RepCV"</span>, <span class="dt">folds =</span> <span class="dv">5</span>, <span class="dt">reps =</span> <span class="dv">4</span>)</span>
<span id="cb3-14"><a href="#cb3-14"></a>r2 =<span class="st"> </span><span class="kw"><a href="../../reference/resample.html">resample</a></span>(<span class="kw"><a href="../../reference/makeLearner.html">makeLearner</a></span>(<span class="st">"classif.qda"</span>), spatial.task, rdesc2, <span class="dt">show.info =</span> <span class="ot">FALSE</span>)</span>
<span id="cb3-15"><a href="#cb3-15"></a> </span>
<span id="cb3-16"><a href="#cb3-16"></a>plots =<span class="st"> </span><span class="kw"><a href="../../reference/createSpatialResamplingPlots.html">createSpatialResamplingPlots</a></span>(spatial.task,</span>
<span id="cb3-17"><a href="#cb3-17"></a>  <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"SpRepCV"</span> =<span class="st"> </span>r1, <span class="st">"RepCV"</span> =<span class="st"> </span>r2), <span class="dt">crs =</span> <span class="dv">32717</span>, <span class="dt">repetitions =</span> <span class="dv">1</span>,</span>
<span id="cb3-18"><a href="#cb3-18"></a>  <span class="dt">x.axis.breaks =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">79.075</span>), <span class="dt">y.axis.breaks =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">3.975</span>))</span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="kw"><a href="https://rdrr.io/pkg/cowplot/man/plot_grid.html">plot_grid</a></span>(<span class="dt">plotlist =</span> plots[[<span class="st">"Plots"</span>]], <span class="dt">ncol =</span> <span class="dv">5</span>, <span class="dt">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb3-20"><a href="#cb3-20"></a>  <span class="dt">labels =</span> plots[[<span class="st">"Labels"</span>]], <span class="dt">label_size =</span> <span class="dv">8</span>)</span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="co">## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font</span></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="co">## family 'Roboto Condensed' not found in PostScript font database</span></span>
<span id="cb3-23"><a href="#cb3-23"></a></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="co">## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font</span></span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="co">## family 'Roboto Condensed' not found in PostScript font database</span></span>
<span id="cb3-26"><a href="#cb3-26"></a></span>
<span id="cb3-27"><a href="#cb3-27"></a><span class="co">## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font</span></span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="co">## family 'Roboto Condensed' not found in PostScript font database</span></span>
<span id="cb3-29"><a href="#cb3-29"></a></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="co">## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font</span></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="co">## family 'Roboto Condensed' not found in PostScript font database</span></span>
<span id="cb3-32"><a href="#cb3-32"></a></span>
<span id="cb3-33"><a href="#cb3-33"></a><span class="co">## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font</span></span>
<span id="cb3-34"><a href="#cb3-34"></a><span class="co">## family 'Roboto Condensed' not found in PostScript font database</span></span>
<span id="cb3-35"><a href="#cb3-35"></a></span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="co">## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font</span></span>
<span id="cb3-37"><a href="#cb3-37"></a><span class="co">## family 'Roboto Condensed' not found in PostScript font database</span></span>
<span id="cb3-38"><a href="#cb3-38"></a></span>
<span id="cb3-39"><a href="#cb3-39"></a><span class="co">## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font</span></span>
<span id="cb3-40"><a href="#cb3-40"></a><span class="co">## family 'Roboto Condensed' not found in PostScript font database</span></span>
<span id="cb3-41"><a href="#cb3-41"></a></span>
<span id="cb3-42"><a href="#cb3-42"></a><span class="co">## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font</span></span>
<span id="cb3-43"><a href="#cb3-43"></a><span class="co">## family 'Roboto Condensed' not found in PostScript font database</span></span>
<span id="cb3-44"><a href="#cb3-44"></a></span>
<span id="cb3-45"><a href="#cb3-45"></a><span class="co">## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font</span></span>
<span id="cb3-46"><a href="#cb3-46"></a><span class="co">## family 'Roboto Condensed' not found in PostScript font database</span></span>
<span id="cb3-47"><a href="#cb3-47"></a></span>
<span id="cb3-48"><a href="#cb3-48"></a><span class="co">## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font</span></span>
<span id="cb3-49"><a href="#cb3-49"></a><span class="co">## family 'Roboto Condensed' not found in PostScript font database</span></span>
<span id="cb3-50"><a href="#cb3-50"></a></span>
<span id="cb3-51"><a href="#cb3-51"></a><span class="co">## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font</span></span>
<span id="cb3-52"><a href="#cb3-52"></a><span class="co">## family 'Roboto Condensed' not found in PostScript font database</span></span>
<span id="cb3-53"><a href="#cb3-53"></a></span>
<span id="cb3-54"><a href="#cb3-54"></a><span class="co">## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font</span></span>
<span id="cb3-55"><a href="#cb3-55"></a><span class="co">## family 'Roboto Condensed' not found in PostScript font database</span></span>
<span id="cb3-56"><a href="#cb3-56"></a></span>
<span id="cb3-57"><a href="#cb3-57"></a><span class="co">## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font</span></span>
<span id="cb3-58"><a href="#cb3-58"></a><span class="co">## family 'Roboto Condensed' not found in PostScript font database</span></span>
<span id="cb3-59"><a href="#cb3-59"></a></span>
<span id="cb3-60"><a href="#cb3-60"></a><span class="co">## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font</span></span>
<span id="cb3-61"><a href="#cb3-61"></a><span class="co">## family 'Roboto Condensed' not found in PostScript font database</span></span></code></pre></div>
<p><img src="handling_of_spatial_data_files/figure-html/unnamed-chunk-6-1.png" width="800px" style="display: block; margin: auto;"></p>
</div>
<div id="notes" class="section level1">
<h1 class="hasAnchor">
<a href="#notes" class="anchor"></a>Notes</h1>
<ul>
<li><p>Some models are more affected by spatial autocorrelation than others. In general, it can be said that the more flexible a model is, the more it will profit from underlying spatial autocorrelation. Simpler models (e.g., GLM) will show less overoptimistic performance estimates.</p></li>
<li><p>The concept of spatial cross-validation was originally implemented in package <a href="https://pat-s.github.io/sperrorest/index.html" target="_blank">sperrorest</a>. This package comes with even more partitioning options and the ability to visualize the spatial grouping of folds. We plan to integrate more functions from <a href="https://pat-s.github.io/sperrorest/index.html" target="_blank">sperrorest</a> into <code>mlr</code> so stay tuned!</p></li>
<li><p>For more detailed information, see <a href="https://www.nat-hazards-earth-syst-sci.net/5/853/2005/">Brenning 2005</a> and <a href="http://ieeexplore.ieee.org/document/6352393/">Brenning2012</a>.</p></li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#how-to-use-spatial-partitioning-in-mlr">How to use spatial partitioning in mlr</a></li>
      <li>
<a href="#examples">Examples</a><ul class="nav nav-pills nav-stacked">
<li><a href="#spatial-cross-validation">Spatial Cross-Validation</a></li>
      <li><a href="#non-spatial-cross-validation">Non-Spatial Cross-Validation</a></li>
      </ul>
</li>
      <li><a href="#visualization-of-spatial-partitions">Visualization of spatial partitions</a></li>
      <li><a href="#notes">Notes</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><!--<div class="copyright">
  <p>Developed by Bernd Bischl, Michel Lang, Lars Kotthoff, Julia Schiffner, Jakob Richter, Zachary Jones, Giuseppe Casalicchio, Mason Gallo, Patrick Schratz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>
--></footer>
</div>

   <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script type="text/javascript"> docsearch({
 apiKey: 'e300ecafdf04fe1199e3339c825ce7d0',
 indexName: 'mlr',
 inputSelector: 'input#search-input.form-control',
 debug: false // Set debug to true if you want to inspect the dropdown
});
</script>
</body>
</html>
